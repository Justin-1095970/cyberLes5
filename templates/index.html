<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>encryption webapp</title>
    <link rel="stylesheet" href="{{ url_for('static' , filename='css/style.css') }}">
</head>
<body>
   <h1>VERY SECURE TEXT ENCRYPTION!!!!!!!!!!</h1>

    <form id="createKeyForm">
        <input type="text" id="keyName" placeholder="name" required>
        <input type="password" id="password" placeholder="password" required>
        <input type="password" id="masterPassword" placeholder="masterPassword" required>
        <button type="submit">create Key</button>
    </form>

    <form id="encryptForm">
        <textarea id="plaintext" placeholder="tekst om te versleuten" required></textarea>
        <input type="text" id="encryptedKeyName" placeholder="key name" required>
        <input type="password" id="encryptedMasterPassword" placeholder="maser password" required>
        <button type="submit">encrypt</button>
    </form>

    <div id="encryptedResult" style="display:none">
        <h3>encrypt tekst: </h3>
        <textarea id="encryptedText" readonly></textarea>
    </div>

   <form id="decryptForm">
        <textarea id="decipherText" placeholder="decrypted tekst" required></textarea>
        <input type="text" id="decryptedKeyName" placeholder="key name" required>
        <input type="password" id="decryptedMasterPassword" placeholder="maser password" required>
        <button type="submit">decrypt</button>
    </form>

    <div id="decryptedResult" style="display:none">
        <h3>decrypt tekst: </h3>
        <textarea id="decryptedText" readonly></textarea>
    </div>

    <div id="message"></div>

    <script>
        document.getElementById('createKeyForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const response = await fetch('/api/create-key', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    keyName: document.getElementById('keyName').value,
                    password: document.getElementById('password').value,
                    masterPassword: document.getElementById('masterPassword').value
                })
            })
            const data = await response.json()
            document.getElementById('message').textContent = data.message
        })

        document.getElementById('encryptForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const response = await fetch('/api/encrypt ', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    plaintext: document.getElementById('plaintext').value,
                    encryptedKeyName: document.getElementById('encryptedKeyName').value,
                    encryptedMasterPassword: document.getElementById('encryptedMasterPassword').value
                })
            })
            const data = await response.json()
            if (data.success) {
                document.getElementById('encryptedText').value = data.result
                document.getElementById('encryptedResult').style.display = 'block'
            }
            document.getElementById('message').textContent = data.message
        })

        document.getElementById('decryptForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const response = await fetch('/api/decrypt', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    decipherText: document.getElementById('decipherText').value,
                    decryptedKeyName: document.getElementById('decryptedKeyName').value,
                    decryptedMasterPassword: document.getElementById('decryptedMasterPassword').value
                })
            })
            const data = await response.json()
            if (data.success) {
                document.getElementById('decryptedText').value = data.result
                document.getElementById('decryptedResult').style.display = 'block'
            }
            document.getElementById('message').textContent = data.message
        })
    </script>

</body>
</html>